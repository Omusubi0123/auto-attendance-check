# 仕様検討書

## 概要

画像認識を用いた自動出欠確認システムの作成

## 仕様案

### 仕様１　画像ファイルを読み込む

- 案１　小型カメラとマイコンを使用して画像を送信
- 案２　データの送信可能なカメラ、スマートフォンを使用して画像を送信
- 案３　PCからカメラ（Webカメラ）ヘアクセスし、撮影・送信を命令する

### 仕様２　画像ファイルを解析する

解析する段階

- 案１ 解析プログラムを、アプリとして使用者に配布する
- 案２ サーバーなど外部の実行環境を用意しそこで解析するためのプログラムを配布する
- 案３ マイコンに解析プログラムをインストールしておき、マイコンで解析する

解析する方法

- 案１ OpenCVを用いる
- 案２ ImageJ, R/Rstudio, Photosyopを使用して画像を解析する

### 仕様３　解析結果（学生の出欠）を出欠ファイルに更新する

出力するファイル形式

- 案１ 出欠ファイルをExcelで作成し・更新する
- 案２ 出欠ファイルをCSVファイルで作成・更新する
- 案３ 出欠ファイルをJsonファイルで作成・更新する

保存するデータ構造

- 案１　データを「クラス->学生->科目と累積欠課時数」という枝構造で記憶する
- 案２　データを「クラス->科目ごとの出席状況（学校の名簿一覧のような形）」という構造で記憶する

### 仕様４　欠席者に個別に連絡する

- 案１　Microsoft Teams のチャット機能で担任のアカウントから連絡
- 案２　Gmailのようなサービスを通して連絡を行う

### 仕様５　学校単位でデータを管理する

- 案１　データベースを用意し、学校ごとにファイルを管理する
- 案２　ホストPC内でファイルを管理する
- 案３　外部のクラウドデータ保存サービスまたはNASを用意し管理する

## 仕様の比較検討

### 仕様１比較検討　画像ファイルを読み込む

- カメラの性能（画質）の点では、案１ = 案２ > 案３
- 汎用性からは、案１ = 案３ > 案２
- このシステムでは、カメラの画質が最重要事項

これらの点から、選んだ案は、案１「小型カメラとマイコンを使用して画像を送信」
（テスト形式ではスマートフォンを使用する）

### 仕様２比較検討　画像ファイルを解析する

解析する段階

- 作成費用の面では、案１>案3>案２（案２はサーバーを借りるから）
- 実装の重さはどれも同じくらいだと考える
- バグ修正などのプログラムの配布、適用の容易さでは、案２>案１=案３
- 汎用性の高さでは案３>案１=案２

カメラ、処理はまとめたほうが使いやすいと考え、案3を選ぶ

解析する方法

- システムの作成にはPythonを使用する　また、PythonではOpenCVを使用できる
→使用言語の統一性を考慮すると、案１>案２
- 過去にある資産の活用性では、案１>案２（Pythonはオープンソース）

これらの比較に、「画像処理の勉強にOpenCVを利用したい」という考えを加え、案１「OpenCVを用いる」を選ぶ

### 仕様３比較検討　解析結果（学生の出欠）を出欠ファイルに更新する

出力するファイル形式

- 実用的な点では、案1 > 2 > 3であると考える
- 実装の簡単さでは、案2 = 3 > 1である
- どれか一つだけのファイル形式では汎用性が低くなると予想し、出力できるファイル形式は上記３つの形式すべてを採用し、ユーザーが選択できるようにする

保存するデータ構造

- 今までの出席簿と同じ形式のほうが、先生側も使いやすいと思う
- 科目のクラスをjsonでシリアライズしそのまま出力すればよさそう

という理由から、現在の群馬高専で使われている名簿と同じデータ構造で保存する。

### 仕様４比較検討　欠席者に個別に連絡する

- 実用的な点、実装の重さのどちらも同じくらいであると予想する
- 群馬高専が使用しているアプリがMicrosoft Teamsだから
- Gmailのようなメール送信よりもチャット機能のほうが手軽だから

というような理由より、Microsoft Teamsを利用する

### 仕様５比較検討　学校単位でデータを管理する

- 実装の重さは変わらないと思うが手続きの手間などを考えると手元で実験できたほうが楽である
- 群馬高専の、one driveなどMicrosoftの有料会員サービスが利用できる利点を生かしたい
- データを保存することだけを行うためスペックの高いPCを必要としない

という理由で案３を採用する

## 仕様最終案

### 操作方法の概略

- 基本的にはラズベリーパイにインストールした出席自動確認プログラムを使用
- 出席状況の確認・編集には、PCにインストールしたGUIアプリを使用

### 処理の流れ

- ラズベリーパイによって撮影（教室に設置したカメラ）
→ラズベリーパイで画像解析
→ラズベリーパイでデータをまとめる
→データをNASまたは外部クラウドに送信
- NASまたは外部クラウドでは学校の全クラス・全科目のデータを一括管理
- 先生のPCではNASまたは外部クラウドに接続し、閲覧・編集が可能

### 開発環境

- windows10, 11
- python3
  - opencv2
  - numpy
  - pandas
  - tkinter

### 使用部品

- Wifi機能を持ったラズベリーパイ
- 小型カメラ
